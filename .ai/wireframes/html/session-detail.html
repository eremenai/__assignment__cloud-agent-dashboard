<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Session Detail - Agent Analytics</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-logo">
        <span class="logo-icon">A</span>
        Agent Analytics
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <a href="overview.html" class="nav-item">
            <span class="icon">üìä</span>
            Overview
          </a>
          <a href="sessions.html" class="nav-item active">
            <span class="icon">üìã</span>
            Sessions
          </a>
          <a href="users.html" class="nav-item">
            <span class="icon">üë•</span>
            Users
          </a>
        </div>
        <div class="nav-divider"></div>
        <div class="nav-section super-admin-only" style="display: none;">
          <a href="global.html" class="nav-item">
            <span class="icon">üåê</span>
            Global
          </a>
        </div>
      </nav>
      <!-- Dev Mode Switcher -->
      <div class="sidebar-footer">
        <div class="role-switcher">
          <span class="role-switcher-label">Dev Mode</span>
          <select id="role-select" onchange="switchRole(this.value)">
            <option value="member">Alice (MEMBER)</option>
            <option value="manager">Bob (MANAGER)</option>
            <option value="admin" selected>Carol (ORG_ADMIN)</option>
            <option value="support">Eve (SUPPORT)</option>
            <option value="super">Frank (SUPER_ADMIN)</option>
          </select>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <div class="main-wrapper">
      <!-- Header -->
      <header class="header">
        <div class="header-left">
          <nav class="breadcrumb" id="breadcrumb">
            <!-- Default: from Sessions list -->
            <a href="sessions.html">Sessions</a>
            <span class="separator">‚Ä∫</span>
            <span class="current">#abc123def</span>
          </nav>
          <!-- Alternate breadcrumb when navigating from User Detail -->
          <!-- Users ‚Ä∫ Alice Member ‚Ä∫ Sessions ‚Ä∫ #abc123def -->
        </div>
        <div class="header-right">
          <div class="dropdown org-selector-wrapper" style="display: none;">
            <button class="dropdown-trigger">
              Acme Corp <span class="chevron">‚ñº</span>
            </button>
          </div>
          <div class="dropdown">
            <button class="dropdown-trigger">
              Last 7 days <span class="chevron">‚ñº</span>
            </button>
          </div>
          <div class="user-menu">
            <div class="user-avatar">CA</div>
            <div class="user-info">
              <div class="user-name">Carol Admin</div>
              <div class="user-role">ORG_ADMIN</div>
            </div>
          </div>
        </div>
      </header>

      <div class="main-content">
        <!-- Session Header -->
        <div class="session-header-card">
          <div class="session-header-top">
            <div>
              <div class="session-id">Session #abc123def</div>
              <div class="session-meta">
                Created by: Alice Member ‚Ä¢ Started: Jan 15, 2024 at 2:34 PM
              </div>
            </div>
            <span class="badge badge-warning">Post-Handoff Iteration</span>
          </div>
          <div class="kpi-row" style="margin-bottom: 0;">
            <div class="kpi-card">
              <div class="kpi-label">
                Lifespan
                <span class="metric-info">?<span class="metric-tooltip">Time between first and last message in this session.</span></span>
              </div>
              <div class="kpi-value">45m</div>
            </div>
            <div class="kpi-card">
              <div class="kpi-label">
                Active Time
                <span class="metric-info">?<span class="metric-tooltip">Total time spent executing runs (sum of all run durations).</span></span>
              </div>
              <div class="kpi-value">12m 5s</div>
            </div>
            <div class="kpi-card">
              <div class="kpi-label">
                Runs
                <span class="metric-info">?<span class="metric-tooltip">Number of agent execution attempts in this session.</span></span>
              </div>
              <div class="kpi-value">4</div>
            </div>
            <div class="kpi-card">
              <div class="kpi-label">
                Local Handoffs
                <span class="metric-info">?<span class="metric-tooltip">Times the user exported session results locally (teleport, CLI, etc).</span></span>
              </div>
              <div class="kpi-value">2</div>
            </div>
            <div class="kpi-card">
              <div class="kpi-label">
                Success Rate
                <span class="metric-info">?<span class="metric-tooltip">Percentage of runs in this session that completed successfully.</span></span>
              </div>
              <div class="kpi-value">75%</div>
            </div>
            <div class="kpi-card">
              <div class="kpi-label">
                Total Cost
                <span class="metric-info">?<span class="metric-tooltip">Sum of all run costs in this session.</span></span>
              </div>
              <div class="kpi-value">$12.34</div>
            </div>
          </div>
        </div>

        <!-- Visual Timeline Bar -->
        <div class="visual-timeline-card">
          <div class="visual-timeline-header">
            <span class="visual-timeline-title">Session Timeline</span>
            <span class="visual-timeline-range">2:34 PM - 3:28 PM (54 min)</span>
          </div>
          <div class="visual-timeline-container">
            <div class="visual-timeline-axis">
              <span class="axis-label start">2:34 PM</span>
              <span class="axis-label end">3:28 PM</span>
            </div>
            <div class="visual-timeline-bar" id="timeline-bar">
              <!-- Run #1: 2:34-2:38 (4min) - success -->
              <div class="timeline-segment run-success"
                   data-event="run-1"
                   style="left: 0%; width: 7.4%;"
                   onmouseenter="showTooltip(event, 'Run #1', 'SUCCESS', '2:34 - 2:38 PM', '4m 12s', '$2.34')"
                   onmouseleave="hideTooltip()"
                   onclick="scrollToEvent('event-run-1-end')">
              </div>
              <!-- Idle: 2:38-2:45 (7min) -->
              <div class="timeline-segment idle"
                   style="left: 7.4%; width: 13%;"
                   onmouseenter="showTooltip(event, 'Idle', null, '2:38 - 2:45 PM', '7m', null)"
                   onmouseleave="hideTooltip()">
              </div>
              <!-- Run #2: 2:45-2:52 (7min) - failed -->
              <div class="timeline-segment run-failed"
                   data-event="run-2"
                   style="left: 20.4%; width: 13%;"
                   onmouseenter="showTooltip(event, 'Run #2', 'FAILED (TIMEOUT)', '2:45 - 2:52 PM', '7m 3s', '$3.12')"
                   onmouseleave="hideTooltip()"
                   onclick="scrollToEvent('event-run-2-end')">
              </div>
              <!-- Idle: 2:52-3:00 (8min) -->
              <div class="timeline-segment idle"
                   style="left: 33.4%; width: 14.8%;"
                   onmouseenter="showTooltip(event, 'Idle', null, '2:52 - 3:00 PM', '8m', null)"
                   onmouseleave="hideTooltip()">
              </div>
              <!-- Handoff: 3:00 -->
              <div class="timeline-segment handoff"
                   data-event="handoff-1"
                   style="left: 48.2%; width: 2%;"
                   onmouseenter="showTooltip(event, 'Local Handoff', 'TELEPORT', '3:00 PM', null, null)"
                   onmouseleave="hideTooltip()"
                   onclick="scrollToEvent('event-handoff-1')">
              </div>
              <!-- Idle: 3:00-3:15 (15min) -->
              <div class="timeline-segment idle"
                   style="left: 50.2%; width: 27.8%;"
                   onmouseenter="showTooltip(event, 'Idle (post-handoff)', null, '3:00 - 3:15 PM', '15m', null)"
                   onmouseleave="hideTooltip()">
              </div>
              <!-- Run #3: 3:15-3:19 (4min) - success -->
              <div class="timeline-segment run-success"
                   data-event="run-3"
                   style="left: 78%; width: 7.4%;"
                   onmouseenter="showTooltip(event, 'Run #3', 'SUCCESS', '3:15 - 3:19 PM', '3m 48s', '$1.89')"
                   onmouseleave="hideTooltip()"
                   onclick="scrollToEvent('event-run-3-end')">
              </div>
              <!-- Run #4: 3:25-3:28 (3min) - success -->
              <div class="timeline-segment run-success"
                   data-event="run-4"
                   style="left: 94.4%; width: 5.6%;"
                   onmouseenter="showTooltip(event, 'Run #4', 'SUCCESS', '3:25 - 3:28 PM', '2m 15s', '$1.45')"
                   onmouseleave="hideTooltip()"
                   onclick="scrollToEvent('event-run-4-end')">
              </div>
            </div>
            <div class="visual-timeline-legend">
              <span class="legend-item"><span class="legend-color run-success"></span> Run (success)</span>
              <span class="legend-item"><span class="legend-color run-failed"></span> Run (failed)</span>
              <span class="legend-item"><span class="legend-color idle"></span> Idle</span>
              <span class="legend-item"><span class="legend-color handoff"></span> Handoff</span>
            </div>
          </div>
          <!-- Tooltip -->
          <div id="timeline-tooltip" class="timeline-tooltip" style="display: none;">
            <div class="tooltip-title"></div>
            <div class="tooltip-status"></div>
            <div class="tooltip-time"></div>
            <div class="tooltip-duration"></div>
            <div class="tooltip-cost"></div>
          </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
          <div class="tab active" onclick="showTab('timeline')">Timeline</div>
          <div class="tab" onclick="showTab('runs')">Runs</div>
          <div class="tab" onclick="showTab('artifacts')">Artifacts</div>
        </div>

        <!-- Timeline Tab -->
        <div id="timeline-tab" class="tab-content">
          <div class="table-card">
            <div class="timeline">
              <div class="timeline-item">
                <div class="timeline-marker user">üë§</div>
                <div class="timeline-content">
                  <div class="timeline-header">
                    <span class="timeline-time">2:34 PM</span>
                    <span class="timeline-actor" style="color: #004085;">USER</span>
                  </div>
                  <div class="timeline-title">Started session</div>
                  <div class="timeline-body">
                    "Fix the login bug in auth.ts - users are getting logged out after 5 minutes"
                  </div>
                </div>
              </div>

              <div class="timeline-item">
                <div class="timeline-marker system">‚ñ∂</div>
                <div class="timeline-content">
                  <div class="timeline-header">
                    <span class="timeline-time">2:34 PM</span>
                    <span class="timeline-actor" style="color: #495057;">SYSTEM</span>
                  </div>
                  <div class="timeline-title">Run #1 started</div>
                </div>
              </div>

              <div class="timeline-item" id="event-run-1-end">
                <div class="timeline-marker success">‚úì</div>
                <div class="timeline-content">
                  <div class="timeline-header">
                    <span class="timeline-time">2:38 PM</span>
                    <span class="timeline-actor" style="color: #155724;">SYSTEM</span>
                  </div>
                  <div class="timeline-title">Run #1 completed <span class="badge badge-success">SUCCESS</span></div>
                  <div class="timeline-meta">
                    <span>Duration: 4m 12s</span>
                    <span>Cost: $2.34</span>
                    <span>Tokens: 45,234</span>
                  </div>
                </div>
              </div>

              <div class="timeline-item">
                <div class="timeline-marker agent">ü§ñ</div>
                <div class="timeline-content">
                  <div class="timeline-header">
                    <span class="timeline-time">2:39 PM</span>
                    <span class="timeline-actor" style="color: #6f42c1;">AGENT</span>
                  </div>
                  <div class="timeline-title">Agent response</div>
                  <div class="timeline-body">
                    "I've fixed the login bug by extending the session timeout in auth.ts. The issue was that the token expiry was set to 5 minutes instead of the intended 30 minutes..."
                  </div>
                </div>
              </div>

              <div class="timeline-item">
                <div class="timeline-marker user">üë§</div>
                <div class="timeline-content">
                  <div class="timeline-header">
                    <span class="timeline-time">2:45 PM</span>
                    <span class="timeline-actor" style="color: #004085;">USER</span>
                  </div>
                  <div class="timeline-title">User message</div>
                  <div class="timeline-body">
                    "Can you also add better error handling for expired tokens?"
                  </div>
                </div>
              </div>

              <div class="timeline-item">
                <div class="timeline-marker system">‚ñ∂</div>
                <div class="timeline-content">
                  <div class="timeline-header">
                    <span class="timeline-time">2:45 PM</span>
                    <span class="timeline-actor" style="color: #495057;">SYSTEM</span>
                  </div>
                  <div class="timeline-title">Run #2 started</div>
                </div>
              </div>

              <div class="timeline-item" id="event-run-2-end">
                <div class="timeline-marker error">‚úó</div>
                <div class="timeline-content">
                  <div class="timeline-header">
                    <span class="timeline-time">2:52 PM</span>
                    <span class="timeline-actor" style="color: #721c24;">SYSTEM</span>
                  </div>
                  <div class="timeline-title">Run #2 completed <span class="badge badge-danger">FAILED</span></div>
                  <div class="timeline-meta">
                    <span>Duration: 7m 3s</span>
                    <span>Error: TIMEOUT</span>
                  </div>
                </div>
              </div>

              <div class="timeline-item" id="event-handoff-1">
                <div class="timeline-marker handoff">‚Üó</div>
                <div class="timeline-content">
                  <div class="timeline-header">
                    <span class="timeline-time">3:00 PM</span>
                    <span class="timeline-actor" style="color: #0c5460;">SYSTEM</span>
                  </div>
                  <div class="timeline-title">Local handoff <span class="badge badge-info">TELEPORT</span></div>
                  <div class="timeline-body">
                    User: alice@acme.com
                  </div>
                </div>
              </div>

              <div class="timeline-item">
                <div class="timeline-marker user">üë§</div>
                <div class="timeline-content">
                  <div class="timeline-header">
                    <span class="timeline-time">3:15 PM</span>
                    <span class="timeline-actor" style="color: #004085;">USER</span>
                  </div>
                  <div class="timeline-title">User message</div>
                  <div class="timeline-body">
                    "Let's try again with a smaller scope - just handle the token refresh"
                  </div>
                </div>
              </div>

              <div class="timeline-item">
                <div class="timeline-marker system">‚ñ∂</div>
                <div class="timeline-content">
                  <div class="timeline-header">
                    <span class="timeline-time">3:15 PM</span>
                    <span class="timeline-actor" style="color: #495057;">SYSTEM</span>
                  </div>
                  <div class="timeline-title">Run #3 started</div>
                </div>
              </div>

              <div class="timeline-item" id="event-run-3-end">
                <div class="timeline-marker success">‚úì</div>
                <div class="timeline-content">
                  <div class="timeline-header">
                    <span class="timeline-time">3:19 PM</span>
                    <span class="timeline-actor" style="color: #155724;">SYSTEM</span>
                  </div>
                  <div class="timeline-title">Run #3 completed <span class="badge badge-success">SUCCESS</span></div>
                  <div class="timeline-meta">
                    <span>Duration: 3m 48s</span>
                    <span>Cost: $1.89</span>
                    <span>Tokens: 32,456</span>
                  </div>
                </div>
              </div>

              <div class="timeline-item" id="event-run-4-end">
                <div class="timeline-marker success">‚úì</div>
                <div class="timeline-content">
                  <div class="timeline-header">
                    <span class="timeline-time">3:28 PM</span>
                    <span class="timeline-actor" style="color: #155724;">SYSTEM</span>
                  </div>
                  <div class="timeline-title">Run #4 completed <span class="badge badge-success">SUCCESS</span></div>
                  <div class="timeline-meta">
                    <span>Duration: 2m 15s</span>
                    <span>Cost: $1.45</span>
                    <span>Tokens: 25,023</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Runs Tab -->
        <div id="runs-tab" class="tab-content" style="display: none;">
          <div class="table-card">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Run #</th>
                  <th>Status</th>
                  <th>Started</th>
                  <th>Duration</th>
                  <th>Queue Wait</th>
                  <th>Input Tokens</th>
                  <th>Output Tokens</th>
                  <th class="text-right">Cost</th>
                  <th>Error</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>1</td>
                  <td><span class="badge badge-success">SUCCESS</span></td>
                  <td>2:34 PM</td>
                  <td>4m 12s</td>
                  <td>8s</td>
                  <td>32,456</td>
                  <td>12,778</td>
                  <td class="text-right font-bold">$2.34</td>
                  <td>-</td>
                </tr>
                <tr>
                  <td>2</td>
                  <td><span class="badge badge-danger">FAILED</span></td>
                  <td>2:45 PM</td>
                  <td>7m 3s</td>
                  <td>12s</td>
                  <td>45,123</td>
                  <td>8,234</td>
                  <td class="text-right font-bold">$3.12</td>
                  <td><span class="text-danger">TIMEOUT</span></td>
                </tr>
                <tr>
                  <td>3</td>
                  <td><span class="badge badge-success">SUCCESS</span></td>
                  <td>3:15 PM</td>
                  <td>3m 48s</td>
                  <td>5s</td>
                  <td>23,456</td>
                  <td>9,000</td>
                  <td class="text-right font-bold">$1.89</td>
                  <td>-</td>
                </tr>
                <tr>
                  <td>4</td>
                  <td><span class="badge badge-success">SUCCESS</span></td>
                  <td>3:25 PM</td>
                  <td>2m 15s</td>
                  <td>3s</td>
                  <td>18,234</td>
                  <td>6,789</td>
                  <td class="text-right font-bold">$1.45</td>
                  <td>-</td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- In-session Charts -->
          <div class="charts-row">
            <div class="chart-card">
              <div class="chart-header">
                <span class="chart-title">
                  Run Duration Distribution
                  <span class="metric-info">?<span class="metric-tooltip">Duration of each run in this session.</span></span>
                </span>
              </div>
              <div class="chart-placeholder">
                [Bar chart: Duration per run]
              </div>
            </div>
            <div class="chart-card">
              <div class="chart-header">
                <span class="chart-title">
                  Run Cost Distribution
                  <span class="metric-info">?<span class="metric-tooltip">Cost breakdown of each run in this session.</span></span>
                </span>
              </div>
              <div class="chart-placeholder">
                [Bar chart: Cost per run]
              </div>
            </div>
          </div>
        </div>

        <!-- Artifacts Tab -->
        <div id="artifacts-tab" class="tab-content" style="display: none;">
          <div class="table-card">
            <div class="table-header">
              <span class="table-title">Files Changed (across all runs)</span>
              <span class="text-muted">5 files | +120 lines | -45 lines</span>
            </div>
            <table class="data-table">
              <thead>
                <tr>
                  <th>File</th>
                  <th class="text-right">Added</th>
                  <th class="text-right">Removed</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="font-mono">src/auth/login.ts</td>
                  <td class="text-right text-success">+45</td>
                  <td class="text-right text-danger">-12</td>
                </tr>
                <tr>
                  <td class="font-mono">src/auth/session.ts</td>
                  <td class="text-right text-success">+23</td>
                  <td class="text-right text-danger">-8</td>
                </tr>
                <tr>
                  <td class="font-mono">src/utils/validate.ts</td>
                  <td class="text-right text-success">+30</td>
                  <td class="text-right text-danger">-15</td>
                </tr>
                <tr>
                  <td class="font-mono">tests/auth.test.ts</td>
                  <td class="text-right text-success">+22</td>
                  <td class="text-right text-danger">-10</td>
                </tr>
                <tr>
                  <td class="font-mono">README.md</td>
                  <td class="text-right text-muted">+0</td>
                  <td class="text-right text-muted">-0</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="table-card">
            <div class="table-header">
              <span class="table-title">Local Handoff History</span>
            </div>
            <table class="data-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Timestamp</th>
                  <th>User</th>
                  <th>Method</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>1</td>
                  <td>Jan 15, 3:00 PM</td>
                  <td>alice@acme.com</td>
                  <td><span class="badge badge-info">TELEPORT</span></td>
                </tr>
                <tr>
                  <td>2</td>
                  <td>Jan 15, 3:45 PM</td>
                  <td>alice@acme.com</td>
                  <td><span class="badge badge-gray">OPEN_IN_CLI</span></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    function showTab(tabName) {
      // Hide all tabs
      document.querySelectorAll('.tab-content').forEach(t => t.style.display = 'none');
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));

      // Show selected tab
      document.getElementById(tabName + '-tab').style.display = 'block';
      event.target.classList.add('active');
    }

    function switchRole(role) {
      const orgSelector = document.querySelector('.org-selector-wrapper');
      const globalNav = document.querySelector('.super-admin-only');
      const userInfo = document.querySelector('.user-info');

      const roles = {
        member: { name: 'Alice Member', role: 'MEMBER', showOrgSelector: false, showGlobal: false },
        manager: { name: 'Bob Manager', role: 'MANAGER', showOrgSelector: false, showGlobal: false },
        admin: { name: 'Carol Admin', role: 'ORG_ADMIN', showOrgSelector: false, showGlobal: false },
        support: { name: 'Eve Support', role: 'SUPPORT', showOrgSelector: true, showGlobal: false },
        super: { name: 'Frank Super', role: 'SUPER_ADMIN', showOrgSelector: true, showGlobal: true }
      };

      const r = roles[role];
      userInfo.innerHTML = `<div class="user-name">${r.name}</div><div class="user-role">${r.role}</div>`;
      document.querySelector('.user-avatar').textContent = r.name.split(' ').map(n => n[0]).join('');

      orgSelector.style.display = r.showOrgSelector ? 'block' : 'none';
      globalNav.style.display = r.showGlobal ? 'block' : 'none';
    }

    switchRole('admin');

    // Contextual Breadcrumbs - check URL params for navigation context
    function updateBreadcrumbs() {
      const urlParams = new URLSearchParams(window.location.search);
      const fromUser = urlParams.get('from_user');
      const breadcrumb = document.getElementById('breadcrumb');

      if (fromUser) {
        // Coming from User Detail page
        breadcrumb.innerHTML = `
          <a href="users.html">Users</a>
          <span class="separator">‚Ä∫</span>
          <a href="user-detail.html">${fromUser}</a>
          <span class="separator">‚Ä∫</span>
          <span>Sessions</span>
          <span class="separator">‚Ä∫</span>
          <span class="current">#abc123def</span>
        `;
      }
      // Otherwise keep default (Sessions > #abc123def)
    }
    updateBreadcrumbs();

    // Visual Timeline Bar interactions
    function showTooltip(event, title, status, time, duration, cost) {
      const tooltip = document.getElementById('timeline-tooltip');
      const rect = event.target.getBoundingClientRect();
      const containerRect = document.querySelector('.visual-timeline-container').getBoundingClientRect();

      tooltip.querySelector('.tooltip-title').textContent = title;
      tooltip.querySelector('.tooltip-status').textContent = status || '';
      tooltip.querySelector('.tooltip-status').style.display = status ? 'block' : 'none';
      tooltip.querySelector('.tooltip-time').textContent = time || '';
      tooltip.querySelector('.tooltip-duration').textContent = duration ? `Duration: ${duration}` : '';
      tooltip.querySelector('.tooltip-duration').style.display = duration ? 'block' : 'none';
      tooltip.querySelector('.tooltip-cost').textContent = cost ? `Cost: ${cost}` : '';
      tooltip.querySelector('.tooltip-cost').style.display = cost ? 'block' : 'none';

      // Position tooltip above the segment
      let left = rect.left - containerRect.left + (rect.width / 2);
      tooltip.style.left = left + 'px';
      tooltip.style.bottom = '60px';
      tooltip.style.display = 'block';

      // Highlight corresponding segment
      event.target.classList.add('segment-hover');
    }

    function hideTooltip() {
      const tooltip = document.getElementById('timeline-tooltip');
      tooltip.style.display = 'none';
      document.querySelectorAll('.timeline-segment').forEach(s => s.classList.remove('segment-hover'));
    }

    function scrollToEvent(eventId) {
      const element = document.getElementById(eventId);
      if (!element) return;

      // Make sure Timeline tab is active
      showTab('timeline');

      // Wait a tick for tab to render
      setTimeout(() => {
        // Scroll to element
        element.scrollIntoView({ behavior: 'smooth', block: 'center' });

        // Add highlight class
        element.classList.add('event-highlight');

        // Remove highlight after 2 seconds
        setTimeout(() => {
          element.classList.remove('event-highlight');
        }, 2000);
      }, 100);
    }
  </script>

  <style>
    /* Visual Timeline Bar Styles */
    .visual-timeline-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: 16px;
      margin-bottom: 16px;
      position: relative;
    }

    .visual-timeline-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .visual-timeline-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .visual-timeline-range {
      font-size: 12px;
      color: var(--text-muted);
    }

    .visual-timeline-container {
      position: relative;
    }

    .visual-timeline-axis {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
    }

    .axis-label {
      font-size: 11px;
      color: var(--text-muted);
    }

    .visual-timeline-bar {
      position: relative;
      height: 32px;
      background: var(--bg-primary);
      border-radius: var(--radius-sm);
      overflow: hidden;
    }

    .timeline-segment {
      position: absolute;
      top: 4px;
      height: 24px;
      border-radius: 3px;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .timeline-segment:hover,
    .timeline-segment.segment-hover {
      transform: scaleY(1.15);
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      z-index: 10;
    }

    .timeline-segment.run-success {
      background: #28a745;
    }

    .timeline-segment.run-failed {
      background: #dc3545;
    }

    .timeline-segment.run-timeout {
      background: #fd7e14;
    }

    .timeline-segment.idle {
      background: #e9ecef;
      cursor: default;
    }

    .timeline-segment.idle:hover {
      transform: none;
      box-shadow: none;
    }

    .timeline-segment.handoff {
      background: #17a2b8;
    }

    .visual-timeline-legend {
      display: flex;
      gap: 16px;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border-light);
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: var(--text-secondary);
    }

    .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 2px;
    }

    .legend-color.run-success { background: #28a745; }
    .legend-color.run-failed { background: #dc3545; }
    .legend-color.idle { background: #e9ecef; border: 1px solid #dee2e6; }
    .legend-color.handoff { background: #17a2b8; }

    /* Tooltip */
    .timeline-tooltip {
      position: absolute;
      background: #1a1a2e;
      color: white;
      padding: 10px 14px;
      border-radius: var(--radius-md);
      font-size: 12px;
      z-index: 100;
      transform: translateX(-50%);
      pointer-events: none;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      min-width: 140px;
    }

    .timeline-tooltip::after {
      content: '';
      position: absolute;
      bottom: -6px;
      left: 50%;
      transform: translateX(-50%);
      border-left: 6px solid transparent;
      border-right: 6px solid transparent;
      border-top: 6px solid #1a1a2e;
    }

    .tooltip-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .tooltip-status {
      color: #adb5bd;
      margin-bottom: 4px;
    }

    .tooltip-time {
      color: #8a8a9a;
      font-size: 11px;
    }

    .tooltip-duration,
    .tooltip-cost {
      color: #e9ecef;
      margin-top: 4px;
    }

    /* Event highlight animation */
    .timeline-item.event-highlight {
      animation: highlightPulse 2s ease-out;
    }

    @keyframes highlightPulse {
      0% {
        background: rgba(74, 144, 217, 0.3);
        box-shadow: 0 0 0 4px rgba(74, 144, 217, 0.2);
      }
      100% {
        background: transparent;
        box-shadow: none;
      }
    }

    .timeline-item {
      border-radius: var(--radius-sm);
      transition: background 0.3s ease;
    }
  </style>
</body>
</html>
